<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronFlow - Workout Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { 'racing': ['Bebas Neue', 'sans-serif'], 'sans': ['Inter', 'sans-serif'] },
            colors: { 'racing-red': '#DC2626', 'racing-blue': '#2563EB', 'racing-cyan': '#06B6D4' }
          }
        }
      }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior: none; -webkit-font-smoothing: antialiased; margin: 0; padding: 0; }
        .racing-stripes { background: linear-gradient(90deg, transparent 45%, #2563EB 45%, #2563EB 48%, #06B6D4 48%, #06B6D4 52%, #2563EB 52%, #2563EB 55%, transparent 55%); }
        .red-metallic { background: linear-gradient(135deg, #DC2626 0%, #EF4444 25%, #DC2626 50%, #B91C1C 75%, #991B1B 100%); }
        .metallic-shine { background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.3) 100%); }
        @keyframes pulse-gauge { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.05); opacity: 0.8; } }
        .gauge-indicator { animation: pulse-gauge 2s ease-in-out infinite; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.2s ease-out; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-950 text-white">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // SVG Icons
        const Icon = ({ children, className = "", ...props }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24" {...props}>{children}</svg>
        );

        const Dumbbell = ({ className }) => <Icon className={className}><path d="M14.4 14.4 9.6 9.6"/><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"/><path d="m21.5 21.5-1.4-1.4"/><path d="M3.9 3.9 2.5 2.5"/><path d="M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z"/></Icon>;
        const Plus = ({ className }) => <Icon className={className}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const X = ({ className }) => <Icon className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const Settings = ({ className }) => <Icon className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const ChevronDown = ({ className }) => <Icon className={className}><path d="m6 9 6 6 6-6"/></Icon>;
        const ChevronRight = ({ className }) => <Icon className={className}><path d="m9 18 6-6-6-6"/></Icon>;
        const Calendar = ({ className }) => <Icon className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>;
        const BarChart3 = ({ className }) => <Icon className={className}><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></Icon>;
        const Shuffle = ({ className }) => <Icon className={className}><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22"/><path d="m18 2 4 4-4 4"/><path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2"/><path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8"/><path d="m18 14 4 4-4 4"/></Icon>;
        const Check = ({ className }) => <Icon className={className}><polyline points="20 6 9 17 4 12"/></Icon>;
        const Save = ({ className }) => <Icon className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
        const RefreshCw = ({ className }) => <Icon className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;

        // Exercise substitution database (compact)
        const EXERCISE_SUBS = {"Dumbbell Incline Chest Press":[{"name":"Double Dumbbell Reverse Grip Bench Press","difficulty":"Novice","equipment":"Dumbbell"},{"name":"Double Dumbbell Bench Press","difficulty":"Beginner","equipment":"Dumbbell"},{"name":"Barbell Bench Press","difficulty":"Novice","equipment":"Barbell"},{"name":"Bodyweight Push Up","difficulty":"Novice","equipment":"Bodyweight"}],"Machine Chest Press":[{"name":"Double Cable Chest Fly","difficulty":"Beginner","equipment":"Cable"},{"name":"Double Dumbbell Bench Press","difficulty":"Beginner","equipment":"Dumbbell"},{"name":"Barbell Bench Press","difficulty":"Novice","equipment":"Barbell"}],"Low to High Cable Fly":[{"name":"Double Cable Chest Fly","difficulty":"Beginner","equipment":"Cable"},{"name":"Double Dumbbell Chest Fly","difficulty":"Beginner","equipment":"Dumbbell"}],"Feet Elevated Push Up":[{"name":"Bodyweight Push Up","difficulty":"Novice","equipment":"Bodyweight"},{"name":"Bodyweight Kneeling Push Up","difficulty":"Beginner","equipment":"Bodyweight"}],"T-Bar Row":[{"name":"Barbell Pendlay Row","difficulty":"Novice","equipment":"Barbell"},{"name":"Barbell Bent Over Row","difficulty":"Novice","equipment":"Barbell"},{"name":"Landmine V Grip Row","difficulty":"Novice","equipment":"Landmine"}],"Lat Pulldown":[{"name":"Cable Wide Grip Lat Pulldown","difficulty":"Beginner","equipment":"Cable"},{"name":"Cable V Grip Lat Pulldown","difficulty":"Beginner","equipment":"Cable"}],"Single Arm Pulldown":[{"name":"Single Arm Cable Half Kneeling Lat Pulldown","difficulty":"Novice","equipment":"Cable"},{"name":"Cable Wide Grip Lat Pulldown","difficulty":"Beginner","equipment":"Cable"}],"Prone Incline DB Row":[{"name":"Double Dumbbell Pendlay Row","difficulty":"Novice","equipment":"Dumbbell"},{"name":"Double Dumbbell Bent Over Row","difficulty":"Beginner","equipment":"Dumbbell"}],"Seated Hamstring Curl":[{"name":"Cable Prone Hamstring Curl","difficulty":"Beginner","equipment":"Cable"},{"name":"Double Dumbbell Romanian Deadlift","difficulty":"Beginner","equipment":"Dumbbell"}],"Bulgarian Split Squat":[{"name":"Double Dumbbell Thruster","difficulty":"Novice","equipment":"Dumbbell"},{"name":"Dumbbell Goblet Squat","difficulty":"Beginner","equipment":"Dumbbell"}],"Hack Squat":[{"name":"Barbell Box Back Squat","difficulty":"Novice","equipment":"Barbell"},{"name":"Barbell High Bar Back Squat","difficulty":"Novice","equipment":"Barbell"}],"Alternating Lunge Barbell":[{"name":"Barbell Box Back Squat","difficulty":"Novice","equipment":"Barbell"},{"name":"Barbell High Bar Back Squat","difficulty":"Novice","equipment":"Barbell"}],"Seated Shoulder Press":[{"name":"Double Dumbbell Z Press","difficulty":"Novice","equipment":"Dumbbell"},{"name":"Barbell Overhead Press","difficulty":"Novice","equipment":"Barbell"}],"Dumbbell Side Lateral Raise":[{"name":"Double Dumbbell Lateral Raise","difficulty":"Beginner","equipment":"Dumbbell"},{"name":"Single Arm Cable Lateral Raise","difficulty":"Beginner","equipment":"Cable"}],"Machine Preacher Curl":[{"name":"Cable Straight Bar Bicep Curl","difficulty":"Beginner","equipment":"Cable"},{"name":"Barbell Curl","difficulty":"Beginner","equipment":"Barbell"},{"name":"Dumbbell Curl","difficulty":"Beginner","equipment":"Dumbbell"}],"Cross Body Tricep Extension":[{"name":"Cable Rope Skull Crusher","difficulty":"Novice","equipment":"Cable"},{"name":"Single Arm Cable Tricep Kickback","difficulty":"Beginner","equipment":"Cable"}],"Low Pulley Cable Curl":[{"name":"Cable Straight Bar Bicep Curl","difficulty":"Beginner","equipment":"Cable"},{"name":"Barbell Curl","difficulty":"Beginner","equipment":"Barbell"},{"name":"Dumbbell Curl","difficulty":"Beginner","equipment":"Dumbbell"}]};

        function App() {
            const [activeTab, setActiveTab] = useState('push');
            const [showSettings, setShowSettings] = useState(false);
            const [showSubstitutes, setShowSubstitutes] = useState(false);
            const [showWorkoutSummary, setShowWorkoutSummary] = useState(false);
            const [selectedExercise, setSelectedExercise] = useState(null);
            const [gSheetUrl, setGSheetUrl] = useState(localStorage.getItem('gSheetUrl') || '');
            const [expandedExercise, setExpandedExercise] = useState(null);
            const [customExercises, setCustomExercises] = useState(() => {
                const saved = localStorage.getItem('customExercises');
                return saved ? JSON.parse(saved) : {};
            });
            
            // Current workout session data
            const [currentWorkout, setCurrentWorkout] = useState(() => {
                const saved = localStorage.getItem('currentWorkout');
                return saved ? JSON.parse(saved) : {};
            });

            const programs = {
                push: {
                    name: 'Push',
                    icon: 'ðŸ’ª',
                    exercises: [
                        { id: 'push-1', name: 'Dumbbell Incline Chest Press', sets: 2, reps: '8-10, 15', rest: 90 },
                        { id: 'push-2', name: 'Machine Chest Press', sets: 3, reps: '10-12', rest: 90 },
                        { id: 'push-3', name: 'Low to High Cable Fly', sets: 3, reps: '15 + DS', rest: 60 },
                        { id: 'push-4', name: 'Feet Elevated Push Up', sets: 2, reps: 'Failure', rest: 60 }
                    ]
                },
                pull: {
                    name: 'Pull',
                    icon: 'ðŸ”™',
                    exercises: [
                        { id: 'pull-1', name: 'T-Bar Row', sets: 3, reps: '10-12', rest: 90 },
                        { id: 'pull-2', name: 'Lat Pulldown', sets: 3, reps: '8-10, 10-12', rest: 60 },
                        { id: 'pull-3', name: 'Single Arm Pulldown', sets: 3, reps: '12-15/side', rest: 60 },
                        { id: 'pull-4', name: 'Prone Incline DB Row', sets: 4, reps: '10-12 + DS', rest: 60 }
                    ]
                },
                legs: {
                    name: 'Legs',
                    icon: 'ðŸ¦µ',
                    exercises: [
                        { id: 'legs-1', name: 'Seated Hamstring Curl', sets: 4, reps: '15/12/12/8', rest: 90 },
                        { id: 'legs-2', name: 'Bulgarian Split Squat', sets: 3, reps: '8-12/side', rest: 60 },
                        { id: 'legs-3', name: 'Hack Squat', sets: 4, reps: '15/12/6/20', rest: 90 },
                        { id: 'legs-4', name: 'Alternating Lunge Barbell', sets: 3, reps: '10-12/side', rest: 60 }
                    ]
                },
                shoulders: {
                    name: 'Shoulders',
                    icon: 'ðŸ’ª',
                    exercises: [
                        { id: 'shoulders-1', name: 'Seated Shoulder Press', sets: 3, reps: '10/15/15', rest: 60 },
                        { id: 'shoulders-2', name: 'Dumbbell Side Lateral Raise', sets: 4, reps: '10-12', rest: 60 },
                        { id: 'shoulders-3', name: 'Machine Preacher Curl', sets: 3, reps: '10-15', rest: 60 },
                        { id: 'shoulders-4', name: 'Cross Body Tricep Extension', sets: 3, reps: '10-15', rest: 60 },
                        { id: 'shoulders-5', name: 'Low Pulley Cable Curl', sets: 3, reps: '10-12', rest: 60 }
                    ]
                }
            };

            const getDisplayExercise = (originalName) => customExercises[originalName] || originalName;

            const substituteExercise = (originalName, newName) => {
                const updated = { ...customExercises, [originalName]: newName };
                setCustomExercises(updated);
                localStorage.setItem('customExercises', JSON.stringify(updated));
                setShowSubstitutes(false);
            };

            const resetExercise = (originalName) => {
                const updated = { ...customExercises };
                delete updated[originalName];
                setCustomExercises(updated);
                localStorage.setItem('customExercises', JSON.stringify(updated));
            };

            const logSet = (exerciseId, setNumber, weight, reps) => {
                const updated = { ...currentWorkout };
                if (!updated[exerciseId]) {
                    updated[exerciseId] = { sets: {} };
                }
                updated[exerciseId].sets[setNumber] = { weight: parseFloat(weight), reps: parseInt(reps) };
                setCurrentWorkout(updated);
                localStorage.setItem('currentWorkout', JSON.stringify(updated));
            };

            const clearWorkout = () => {
                setCurrentWorkout({});
                localStorage.removeItem('currentWorkout');
            };

            const saveWorkout = async () => {
                const workoutData = {
                    date: new Date().toISOString(),
                    program: activeTab,
                    exercises: Object.keys(currentWorkout).map(exerciseId => {
                        const exercise = programs[activeTab].exercises.find(e => e.id === exerciseId);
                        return {
                            name: getDisplayExercise(exercise.name),
                            originalName: exercise.name,
                            sets: currentWorkout[exerciseId].sets
                        };
                    })
                };

                // Save to localStorage history
                const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                history.unshift(workoutData);
                localStorage.setItem('workoutHistory', JSON.stringify(history.slice(0, 50)));

                // Try to save to Google Sheets
                if (gSheetUrl) {
                    try {
                        await fetch(gSheetUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(workoutData)
                        });
                    } catch (error) {
                        console.error('Google Sheets sync failed:', error);
                    }
                }

                clearWorkout();
                setShowWorkoutSummary(false);
                alert('âœ… Workout saved successfully!');
            };

            const getTotalSetsLogged = () => {
                return Object.values(currentWorkout).reduce((total, ex) => {
                    return total + Object.keys(ex.sets).length;
                }, 0);
            };

            useEffect(() => {
                localStorage.setItem('currentWorkout', JSON.stringify(currentWorkout));
            }, [currentWorkout]);

            return (
                <div className="min-h-screen pb-32">
                    <div className="h-1 racing-stripes"></div>

                    <header className="bg-slate-900 border-b-2 border-racing-red">
                        <div className="p-6 max-w-7xl mx-auto">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className="relative w-14 h-14 rounded-lg overflow-hidden shadow-xl">
                                        <div className="absolute inset-0 red-metallic"></div>
                                        <div className="absolute inset-0 metallic-shine opacity-30"></div>
                                        <div className="relative flex items-center justify-center h-full">
                                            <Dumbbell className="w-7 h-7 text-white drop-shadow-lg" />
                                        </div>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-racing tracking-wider text-white">IRONFLOW</h1>
                                        <p className="text-xs text-slate-400 tracking-widest">PRECISION TRAINING</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3">
                                    {getTotalSetsLogged() > 0 && (
                                        <button onClick={() => setShowWorkoutSummary(true)} className="px-4 py-2 bg-racing-red hover:bg-red-600 rounded-lg transition-all flex items-center gap-2">
                                            <Save className="w-4 h-4" />
                                            <span className="font-racing text-sm">SAVE ({getTotalSetsLogged()})</span>
                                        </button>
                                    )}
                                    <button onClick={() => setShowSettings(true)} className="p-3 hover:bg-slate-800 rounded-lg transition-all border border-slate-700">
                                        <Settings className="w-5 h-5 text-slate-400" />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-6">
                        <div className="flex gap-3 mb-6 overflow-x-auto scrollbar-hide pb-2">
                            {Object.entries(programs).map(([key, program]) => (
                                <button
                                    key={key}
                                    onClick={() => setActiveTab(key)}
                                    className={`flex-shrink-0 px-6 py-3 font-racing text-lg tracking-wider transition-all ${
                                        activeTab === key ? 'bg-racing-red text-white scale-105' : 'bg-slate-800 text-slate-400'
                                    }`}
                                    style={{ clipPath: 'polygon(8% 0%, 100% 0%, 92% 100%, 0% 100%)' }}
                                >
                                    {program.icon} {program.name}
                                </button>
                            ))}
                        </div>

                        <div className="space-y-4">
                            {programs[activeTab].exercises.map((ex) => {
                                const displayName = getDisplayExercise(ex.name);
                                const isCustom = displayName !== ex.name;
                                const exerciseData = currentWorkout[ex.id];
                                
                                return (
                                    <div key={ex.id} className="bg-slate-900 border-2 border-slate-800 hover:border-racing-red transition-all" style={{ clipPath: 'polygon(0 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%)' }}>
                                        <button onClick={() => setExpandedExercise(expandedExercise === ex.id ? null : ex.id)} className="w-full p-6 flex items-center justify-between text-left">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-2">
                                                    <h3 className="font-bold text-lg text-white">{displayName}</h3>
                                                    {isCustom && <span className="px-2 py-0.5 bg-racing-blue/20 border border-racing-blue text-racing-blue text-xs font-racing">ALT</span>}
                                                    {exerciseData && Object.keys(exerciseData.sets).length > 0 && (
                                                        <span className="px-2 py-0.5 bg-racing-red/20 border border-racing-red text-racing-red text-xs font-racing">
                                                            {Object.keys(exerciseData.sets).length}/{ex.sets} LOGGED
                                                        </span>
                                                    )}
                                                </div>
                                                <div className="flex gap-5 text-sm">
                                                    <span className="flex items-center gap-2 text-slate-400">
                                                        <div className="w-2 h-2 rounded-full bg-racing-red gauge-indicator"></div>
                                                        <span className="font-racing">{ex.sets} SETS</span>
                                                    </span>
                                                    <span className="flex items-center gap-2 text-slate-400">
                                                        <div className="w-2 h-2 rounded-full bg-racing-blue gauge-indicator" style={{animationDelay: '0.3s'}}></div>
                                                        <span className="font-racing">{ex.reps} REPS</span>
                                                    </span>
                                                    <span className="flex items-center gap-2 text-slate-400">
                                                        <div className="w-2 h-2 rounded-full bg-racing-cyan gauge-indicator" style={{animationDelay: '0.6s'}}></div>
                                                        <span className="font-racing">{ex.rest}S</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <ChevronDown className={`w-6 h-6 text-slate-500 transition-transform ${expandedExercise === ex.id ? 'rotate-180 text-racing-red' : ''}`} />
                                        </button>

                                        {expandedExercise === ex.id && (
                                            <div className="px-6 pb-6 border-t-2 border-slate-800 pt-5 space-y-4">
                                                {/* Per-Set Tracking */}
                                                <div className="space-y-2">
                                                    {[...Array(ex.sets)].map((_, setIdx) => {
                                                        const setNum = setIdx + 1;
                                                        const setData = exerciseData?.sets?.[setNum];
                                                        
                                                        return (
                                                            <div key={setNum} className="bg-slate-950 p-4 rounded border border-slate-800">
                                                                <div className="flex items-center gap-4">
                                                                    <div className="w-12 flex-shrink-0">
                                                                        <p className="text-xs text-slate-500 font-racing">SET</p>
                                                                        <p className="text-2xl font-racing text-racing-red">{setNum}</p>
                                                                    </div>
                                                                    <div className="flex-1 grid grid-cols-2 gap-3">
                                                                        <div>
                                                                            <label className="text-xs text-slate-500 font-racing">WEIGHT (LBS)</label>
                                                                            <input
                                                                                type="number"
                                                                                step="0.5"
                                                                                value={setData?.weight || ''}
                                                                                onChange={(e) => logSet(ex.id, setNum, e.target.value, setData?.reps || '')}
                                                                                className="w-full bg-slate-900 border border-slate-700 px-3 py-2 text-white font-racing text-lg rounded focus:border-racing-blue outline-none"
                                                                                placeholder="135"
                                                                            />
                                                                        </div>
                                                                        <div>
                                                                            <label className="text-xs text-slate-500 font-racing">REPS</label>
                                                                            <input
                                                                                type="number"
                                                                                value={setData?.reps || ''}
                                                                                onChange={(e) => logSet(ex.id, setNum, setData?.weight || '', e.target.value)}
                                                                                className="w-full bg-slate-900 border border-slate-700 px-3 py-2 text-white font-racing text-lg rounded focus:border-racing-blue outline-none"
                                                                                placeholder="10"
                                                                            />
                                                                        </div>
                                                                    </div>
                                                                    {setData && (
                                                                        <Check className="w-6 h-6 text-racing-cyan flex-shrink-0" />
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>

                                                <div className="pt-4 border-t border-slate-800">
                                                    <button 
                                                        onClick={(e) => { 
                                                            e.stopPropagation(); 
                                                            setSelectedExercise(ex);
                                                            setShowSubstitutes(true);
                                                        }} 
                                                        className="w-full bg-slate-800 border-2 border-racing-blue hover:border-racing-cyan py-3 font-racing text-sm text-racing-blue hover:text-racing-cyan transition-all flex items-center justify-center gap-2"
                                                    >
                                                        <Shuffle className="w-4 h-4" />
                                                        SWITCH EXERCISE
                                                    </button>
                                                    {isCustom && (
                                                        <button 
                                                            onClick={(e) => { 
                                                                e.stopPropagation(); 
                                                                resetExercise(ex.name); 
                                                            }} 
                                                            className="w-full mt-2 py-2 text-xs font-racing text-slate-500 hover:text-racing-red transition-colors flex items-center justify-center gap-2"
                                                        >
                                                            <RefreshCw className="w-3 h-3" />
                                                            RESET TO: {ex.name}
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-slate-950 border-t-2 border-racing-red z-40">
                        <div className="h-1 racing-stripes"></div>
                        <div className="flex justify-around p-4">
                            <button className="flex flex-col items-center gap-2">
                                <div className="p-2 bg-racing-red/20 border border-racing-red rounded-lg">
                                    <Dumbbell className="w-6 h-6 text-racing-red" />
                                </div>
                                <span className="text-xs font-racing text-racing-red">WORKOUTS</span>
                            </button>
                            <button className="flex flex-col items-center gap-2">
                                <div className="p-2 rounded-lg">
                                    <BarChart3 className="w-6 h-6 text-slate-600" />
                                </div>
                                <span className="text-xs font-racing text-slate-600">PROGRESS</span>
                            </button>
                            <button className="flex flex-col items-center gap-2">
                                <div className="p-2 rounded-lg">
                                    <Calendar className="w-6 h-6 text-slate-600" />
                                </div>
                                <span className="text-xs font-racing text-slate-600">HISTORY</span>
                            </button>
                        </div>
                    </nav>

                    {/* Exercise Substitution Modal */}
                    {showSubstitutes && selectedExercise && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                            <div className="bg-slate-900 w-full max-w-md max-h-[80vh] border-2 border-racing-blue shadow-2xl overflow-hidden flex flex-col">
                                <div className="p-6 border-b-2 border-slate-800">
                                    <div className="flex items-center justify-between mb-3">
                                        <h2 className="text-2xl font-racing text-white">SWITCH EXERCISE</h2>
                                        <button onClick={() => setShowSubstitutes(false)} className="p-2 hover:bg-slate-800 rounded-lg">
                                            <X className="w-6 h-6 text-slate-400" />
                                        </button>
                                    </div>
                                    <p className="text-sm text-slate-400">Alternatives for: <span className="font-semibold text-white">{selectedExercise.name}</span></p>
                                </div>

                                <div className="flex-1 overflow-y-auto p-4 space-y-2">
                                    {EXERCISE_SUBS[selectedExercise.name]?.map((alt, idx) => (
                                        <button 
                                            key={idx} 
                                            onClick={() => substituteExercise(selectedExercise.name, alt.name)} 
                                            className="w-full text-left bg-slate-800 hover:bg-slate-750 border border-slate-700 hover:border-racing-blue p-4 transition-all group"
                                        >
                                            <div className="flex items-start justify-between gap-3">
                                                <div className="flex-1">
                                                    <p className="font-semibold text-white mb-1 group-hover:text-racing-blue">{alt.name}</p>
                                                    <div className="flex gap-3 text-xs">
                                                        <span className="px-2 py-0.5 bg-slate-900 text-slate-400 font-racing">{alt.difficulty}</span>
                                                        <span className="px-2 py-0.5 bg-slate-900 text-slate-400 font-racing">{alt.equipment}</span>
                                                    </div>
                                                </div>
                                                <ChevronRight className="w-5 h-5 text-slate-600 group-hover:text-racing-blue flex-shrink-0" />
                                            </div>
                                        </button>
                                    )) || <div className="text-center py-8 text-slate-500"><p className="font-racing">No alternatives available</p></div>}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Workout Summary Modal */}
                    {showWorkoutSummary && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                            <div className="bg-slate-900 w-full max-w-md border-2 border-racing-red shadow-2xl">
                                <div className="p-6 border-b-2 border-slate-800">
                                    <div className="flex items-center justify-between mb-3">
                                        <h2 className="text-3xl font-racing text-white">SAVE WORKOUT</h2>
                                        <button onClick={() => setShowWorkoutSummary(false)} className="p-2 hover:bg-slate-800 rounded-lg">
                                            <X className="w-7 h-7 text-slate-400" />
                                        </button>
                                    </div>
                                    <p className="text-sm text-slate-400">{new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                </div>

                                <div className="p-6 space-y-4">
                                    <div className="space-y-3">
                                        {Object.keys(currentWorkout).map(exerciseId => {
                                            const exercise = programs[activeTab].exercises.find(e => e.id === exerciseId);
                                            const sets = currentWorkout[exerciseId].sets;
                                            return (
                                                <div key={exerciseId} className="bg-slate-950 p-4 rounded border-l-4 border-racing-red">
                                                    <p className="font-semibold text-white mb-2">{getDisplayExercise(exercise.name)}</p>
                                                    <div className="space-y-1">
                                                        {Object.entries(sets).map(([setNum, data]) => (
                                                            <p key={setNum} className="text-sm text-slate-400 font-racing">
                                                                Set {setNum}: {data.weight}lbs Ã— {data.reps} reps
                                                            </p>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <div className="grid grid-cols-2 gap-3 pt-4">
                                        <button onClick={clearWorkout} className="py-3 bg-slate-800 hover:bg-slate-700 border border-slate-700 font-racing text-white rounded transition-all">
                                            DISCARD
                                        </button>
                                        <button onClick={saveWorkout} className="relative overflow-hidden">
                                            <div className="absolute inset-0 red-metallic"></div>
                                            <div className="absolute inset-0 metallic-shine opacity-30"></div>
                                            <div className="relative py-3 font-racing text-white flex items-center justify-center gap-2">
                                                <Check className="w-5 h-5" />
                                                SAVE
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                            <div className="bg-slate-900 w-full max-w-md border-2 border-slate-700 shadow-2xl">
                                <div className="p-6 border-b-2 border-slate-800">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-3xl font-racing text-white">SETTINGS</h2>
                                        <button onClick={() => setShowSettings(false)} className="p-2 hover:bg-slate-800 rounded-lg">
                                            <X className="w-7 h-7 text-slate-400" />
                                        </button>
                                    </div>
                                </div>

                                <div className="p-6 space-y-6">
                                    <div>
                                        <label className="block text-xs font-racing mb-3 text-slate-400">GOOGLE SHEETS URL</label>
                                        <input 
                                            type="text" 
                                            value={gSheetUrl} 
                                            onChange={(e) => setGSheetUrl(e.target.value)} 
                                            className="w-full bg-slate-950 border-2 border-slate-700 px-4 py-3 text-white focus:border-racing-blue outline-none text-sm" 
                                            placeholder="https://script.google.com/macros/s/..." 
                                        />
                                    </div>

                                    <button 
                                        onClick={() => {
                                            localStorage.setItem('gSheetUrl', gSheetUrl);
                                            setShowSettings(false);
                                            alert('âš™ï¸ Settings saved!');
                                        }} 
                                        className="w-full py-4 bg-slate-800 hover:bg-slate-700 font-racing text-xl text-white rounded transition-all"
                                    >
                                        SAVE SETTINGS
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
